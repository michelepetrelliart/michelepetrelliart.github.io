<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<title>...</title>
<style>body { background: #000; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }</style>

<script src="//static.getclicky.com/js"></script>
<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101499862);</script>

<script>
(function() {
    const links = {
        'patreon': "https://www.patreon.com/c/michelepetrelliart",
        'substack': "https://recordsnode.substack.com"
    };
    const githubHome = "https://michelepetrelliart.github.io/pages_static/all.html";

    // 1. LEGGE I PARAMETRI DALL'URL
    const urlParams = new URLSearchParams(window.location.search);
    const toParam = urlParams.get('to');
    const refParam = urlParams.get('ref');

    const isItalian = (navigator.languages || [navigator.language]).some(l => l.toLowerCase().startsWith('it')) ||
                      Intl.DateTimeFormat().resolvedOptions().timeZone === 'Europe/Rome';

    let target, label;

    // 2. LOGICA DI DESTINAZIONE E ETICHETTA BASE
    if (isItalian) {
        target = githubHome;
        label = "RD_ITALY_BOUNCE";
    } else {
        const destination = toParam || 'patreon';
        target = links[destination] || githubHome;
        label = "RD_INT_" + destination.toUpperCase();
    }

    // 3. AGGIUNTA DINAMICA ALLA LABEL
    if (refParam) {
        label += "_" + refParam.toUpperCase();
    }

    function finalTest() {
        const currentUrl = window.location.href;

        // Creiamo un finto referrer basato sul parametro ref per popolare il campo a destra
        // Se ref=xbio, Clicky vedr√† provenienza da xbio.com
        const fakeReferrer = refParam ? "https://" + refParam.toLowerCase() + ".com" : document.referrer;

        if (navigator.sendBeacon) {
            // Aggiungiamo il parametro &ref= alla chiamata beacon
            const beaconUrl = "https://in.getclicky.com/in.php?site_id=101499862&type=pageview&href=" +
                              encodeURIComponent(currentUrl) +
                              "&title=" + encodeURIComponent(label) +
                              "&ref=" + encodeURIComponent(fakeReferrer);
            navigator.sendBeacon(beaconUrl);
        } else if (window.clicky) {
            clicky.log(currentUrl, label, "click");
        }

        setTimeout(function() {
            window.location.replace(target);
        }, 500);
    }

    window.onload = finalTest;
})();
</script>
</head>
<body style="background: #000;">
</body>
</html>
