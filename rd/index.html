<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<title>...</title>
<style>body { background: #000; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }</style>

<script src="//static.getclicky.com/js"></script>
<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101499862);</script>

<script>
(function() {
    const links = {
        'patreon': "https://www.patreon.com/c/michelepetrelliart",
        'substack': "https://recordsnode.substack.com"
    };
    const githubHome = "https://michelepetrelliart.github.io/pages_static/all.html";

    // 1. LEGGE I PARAMETRI DALL'URL
    const urlParams = new URLSearchParams(window.location.search);
    const toParam = urlParams.get('to');
    const refParam = urlParams.get('ref'); // Prende xbio, instabio, ecc.

    const isItalian = (navigator.languages || [navigator.language]).some(l => l.toLowerCase().startsWith('it')) ||
                      Intl.DateTimeFormat().resolvedOptions().timeZone === 'Europe/Rome';

    let target, label;

    // 2. LOGICA DI DESTINAZIONE E ETICHETTA BASE
    if (isItalian) {
        target = githubHome;
        label = "RD_ITALY_BOUNCE";
    } else {
        const destination = toParam || 'patreon';
        target = links[destination] || githubHome;
        label = "RD_INT_" + destination.toUpperCase();
    }

    // 3. AGGIUNTA DINAMICA DEL REFERRER (Il punto cruciale)
    // Se refParam esiste, lo aggiunge alla label. Altrimenti non aggiunge nulla.
    if (refParam) {
        label += "_" + refParam.toUpperCase();
    }

    function finalTest() {
        if (navigator.sendBeacon) {
            const beaconUrl = "https://in.getclicky.com/in.php?site_id=101499862&type=pageview&href=" +
                              encodeURIComponent(window.location.href) + "&title=" + encodeURIComponent(label);
            navigator.sendBeacon(beaconUrl);
        } else if (window.clicky) {
            clicky.log(window.location.href, label, "click");
        }

        setTimeout(function() {
            window.location.replace(target);
        }, 500); // Mezzo secondo per essere sicuri che Clicky riceva il segnale
    }

    window.onload = finalTest;
})();
</script>
</head>
<body>
    <div style="color: #222; font-family: sans-serif; font-size: 11px;">Redirecting...</div>
</body>
</html>
