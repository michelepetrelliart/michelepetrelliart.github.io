<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<title>...</title>
<style>body { background: #000; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }</style>

<noscript>
    <meta http-equiv="refresh" content="0;url=https://michelepetrelliart.github.io/pages_static/all.html">
</noscript>

<script src="//static.getclicky.com/js"></script>
<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101499862);</script>

<script>
(function() {
    const links = {
        'patreon': "https://www.patreon.com/c/michelepetrelliart",
        'substack': "https://recordsnode.substack.com",
        'inprnt': "https://www.inprnt.com/gallery/michelepetrelli/"
    };
    const githubHome = "https://michelepetrelliart.github.io/pages_static/all.html";

    const urlParams = new URLSearchParams(window.location.search);
    let toParam = urlParams.get('to');
    if (toParam) toParam = toParam.toLowerCase();
    const refParam = urlParams.get('ref');

    const isItalian = (navigator.languages || [navigator.language]).some(l => l.toLowerCase().startsWith('it')) ||
                      Intl.DateTimeFormat().resolvedOptions().timeZone === 'Europe/Rome';

    let target, label;

    // Se esiste un parametro "to" valido, lo usiamo a prescindere dalla lingua
    if (toParam && links[toParam]) {
        target = links[toParam];
        label = "RD_INT_" + toParam.toUpperCase();
    } else if (isItalian) {
        target = githubHome;
        label = "RD_ITALY_BOUNCE";
    } else {
        target = links['patreon'];
        label = "RD_INT_PATREON";
    }

    if (refParam) {
        label += "_" + refParam.toUpperCase();
    }

    function finalTest() {
        const currentUrl = window.location.href;
        const fakeReferrer = refParam ? "https://" + refParam.toLowerCase() + ".com" : document.referrer;

        try {
            if (navigator.sendBeacon) {
                const beaconUrl = "https://in.getclicky.com/in.php?site_id=101499862&type=pageview&href=" +
                                  encodeURIComponent(currentUrl) +
                                  "&title=" + encodeURIComponent(label) +
                                  "&ref=" + encodeURIComponent(fakeReferrer);
                navigator.sendBeacon(beaconUrl);
            } else if (window.clicky) {
                clicky.log(currentUrl, label, "click");
            }
        } catch (e) {
            console.log("Analytics error, proceeding anyway...");
        }

        // Redirect forzato
        setTimeout(function() {
            window.location.replace(target);
        }, 300);
    }

    window.onload = finalTest;
})();
</script>
</head>
<body style="background: #000;">
</body>
</html>
